<!DOCTYPE html>
<html lang="de" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RMSE Leaderboard</title>
    <script src="https://cdn.jsdelivr.net/npm/papaparse@5"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .fade-in {
            animation: fadeIn 0.3s ease-out forwards;
        }
        .rank-badge {
            width: 48px;
            height: 48px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
        }
        .loading-spinner {
            border: 3px solid #374151;
            border-top: 3px solid #3b82f6;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="bg-gradient-to-br from-gray-900 to-gray-800 min-h-screen p-4 md:p-8">
    <div class="max-w-6xl mx-auto">
        <!-- Header -->
        <div class="text-center mb-8">
            <h1 class="text-5xl font-bold text-white mb-2">üèÜ Leaderboard</h1>
            <p class="text-gray-300 text-lg">RMSE Competition Rankings</p>
            <div id="lastUpdate" class="text-sm text-gray-400 mt-2"></div>
        </div>

        <!-- Search & Filter -->
        <div class="mb-6 bg-gray-800 rounded-lg shadow-md p-4">
            <input 
                type="text" 
                id="searchInput" 
                placeholder="üîç Suche nach Participant ID oder Submission..." 
                class="w-full px-4 py-3 border border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 bg-gray-700 text-white placeholder-gray-400"
            />
        </div>

        <!-- Loading State -->
        <div id="loading" class="flex justify-center items-center py-20">
            <div class="loading-spinner"></div>
        </div>

        <!-- Error State -->
        <div id="error" class="hidden bg-red-900 border border-red-600 text-red-200 px-4 py-3 rounded-lg mb-6">
            <strong>Fehler:</strong> <span id="errorMessage"></span>
        </div>

        <!-- Leaderboard -->
        <div id="leaderboard" class="space-y-3"></div>

        <!-- Stats Footer -->
        <div id="stats" class="mt-8 grid grid-cols-1 md:grid-cols-3 gap-4"></div>
    </div>

    <script>
        // URL anpassen f√ºr Upload CSV
        const CSV_URL = 'https://kev2596.github.io/leaderboard/rmse_ranking.csv';
        
        let allData = [];
        let filteredData = [];

        // CSV laden und parsen
        function loadLeaderboard() {
            console.log('üîç Lade CSV von:', CSV_URL);
            Papa.parse(CSV_URL, {
                download: true,
                header: true,
                complete: function(results) {
                    console.log('‚úÖ CSV geladen! Rohdaten:', results);
                    console.log('üìä Anzahl Zeilen:', results.data.length);
                    console.log('üìã Erste Zeile:', results.data[0]);
                    
                    allData = results.data.filter(row => row.Rank && row.RMSE);
                    console.log('‚úîÔ∏è Nach Filter:', allData.length, 'Zeilen');
                    console.log('üìù Gefilterte Daten:', allData);
                    
                    filteredData = allData;
                    document.getElementById('loading').style.display = 'none';
                    renderLeaderboard();
                    renderStats();
                    updateTimestamp();
                },
                error: function(error) {
                    console.error('‚ùå Fehler beim Laden:', error);
                    document.getElementById('loading').style.display = 'none';
                    showError('Konnte CSV nicht laden: ' + error.message);
                }
            });
        }

        // Leaderboard rendern
        function renderLeaderboard() {
            const container = document.getElementById('leaderboard');
            
            if (filteredData.length === 0) {
                container.innerHTML = `
                    <div class="bg-gray-800 rounded-lg shadow-md p-8 text-center text-gray-400">
                        Keine Ergebnisse gefunden.
                    </div>
                `;
                return;
            }

            const html = filteredData.map((row, index) => {
                const rank = parseInt(row.Rank);
                const isTopThree = rank <= 3;
                const medal = rank === 1 ? 'ü•á' : rank === 2 ? 'ü•à' : rank === 3 ? 'ü•â' : '';
                const bgColor = isTopThree 
                    ? 'bg-gradient-to-r from-yellow-900/20 to-orange-900/20' 
                    : 'bg-gray-800';
                const borderColor = isTopThree 
                    ? 'border-yellow-600' 
                    : 'border-gray-700';
                
                return `
                    <div class="fade-in ${bgColor} rounded-lg shadow-md border-2 ${borderColor} p-5 hover:shadow-xl transition-all duration-300" style="animation-delay: ${index * 0.05}s">
                        <div class="flex items-center justify-between">
                            <!-- Rank Badge -->
                            <div class="rank-badge ${isTopThree ? 'text-4xl' : 'text-2xl font-bold text-gray-500'}">
                                ${medal || rank}
                            </div>

                            <!-- Participant Info -->
                            <div class="flex-1 mx-6">
                                <div class="text-xl font-bold text-white">
                                    ${row.Submission_ID}
                                </div>
                                <div class="text-sm text-gray-300 mt-1">
                                    <span class="inline-block bg-blue-900 text-blue-200 px-2 py-1 rounded mr-2">
                                        Participant ${row.Participant_ID}
                                    </span>
                                    <span class="inline-block bg-green-900 text-green-200 px-2 py-1 rounded">
                                        Submission #${row.Submission_Num}
                                    </span>
                                </div>
                            </div>

                            <!-- RMSE Score -->
                            <div class="text-right">
                                <div class="text-3xl font-mono font-bold ${isTopThree ? 'text-orange-400' : 'text-gray-300'}">
                                    ${parseFloat(row.RMSE).toFixed(6)}
                                </div>
                                <div class="text-xs text-gray-400 uppercase tracking-wider mt-1">
                                    RMSE
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');

            container.innerHTML = html;
        }

        // Statistiken rendern
        function renderStats() {
            const totalSubmissions = allData.length;
            const uniqueParticipants = new Set(allData.map(r => r.Participant_ID)).size;
            const bestRMSE = allData.length > 0 ? parseFloat(allData[0].RMSE).toFixed(6) : 'N/A';

            document.getElementById('stats').innerHTML = `
                <div class="bg-gray-800 rounded-lg shadow-md p-6 text-center">
                    <div class="text-4xl font-bold text-blue-400">${totalSubmissions}</div>
                    <div class="text-gray-300 mt-2">Submissions</div>
                </div>
                <div class="bg-gray-800 rounded-lg shadow-md p-6 text-center">
                    <div class="text-4xl font-bold text-green-400">${uniqueParticipants}</div>
                    <div class="text-gray-300 mt-2">Teilnehmer</div>
                </div>
                <div class="bg-gray-800 rounded-lg shadow-md p-6 text-center">
                    <div class="text-4xl font-bold text-orange-400">${bestRMSE}</div>
                    <div class="text-gray-300 mt-2">Bester RMSE</div>
                </div>
            `;
        }

        // Suchfunktion
        document.getElementById('searchInput').addEventListener('input', function(e) {
            const query = e.target.value.toLowerCase();
            filteredData = allData.filter(row => 
                row.Submission_ID.toLowerCase().includes(query) ||
                row.Participant_ID.toLowerCase().includes(query)
            );
            renderLeaderboard();
        });

        // Timestamp aktualisieren
        function updateTimestamp() {
            const now = new Date();
            document.getElementById('lastUpdate').textContent = 
                `Letzte Aktualisierung: ${now.toLocaleString('de-DE')}`;
        }

        // Fehler anzeigen
        function showError(message) {
            document.getElementById('errorMessage').textContent = message;
            document.getElementById('error').classList.remove('hidden');
        }

        // Auto-Refresh alle 5 Minuten
        setInterval(loadLeaderboard, 5 * 60 * 1000);

        // Initialize
        loadLeaderboard();
    </script>
</body>

</html>
